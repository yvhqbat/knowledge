# mysql视频

工具：
绘图： processon.com
mysql客户端： navicat
markdown: typora

## 1. mysql 架构
连接器
分析器：词法分析、语法分析
优化器：
执行器：实际执行组件
存储引擎

mysql8.0之后移除了缓存

SQL  抽象语法树  解析MYSQL  apache.calcite语法解析器

为什么不使用 `select * from tb`？主要原因在于**IO消耗**

## 2. mysql有几种存储引擎？有什么区别？
`show engines;`

主要使用 InnoDB、MyISAM、Memory等

存储引擎是在表那一层的，而不是数据库层。
mysql默认使用InnoDB存储引擎

.frm用来存储表结构的

## 3. 事务

银行转账，事务引入，需要三条SQL语句

1. 查询，查询够不够
2. 减钱
3. 加钱
事务：要么全部执行成功，要么全部执行失败（回滚）；begin/commit/rollback

事务的传播特性：扁平事务、

### 3.1 事务的ACID特性

1. 原子性，要么全部执行成功，要么全部执行失败。
实现原理： undo log
undo log 是逻辑日志，可以理解为：
- 当delete一条记录时，undo log记录一条insert记录；
- insert -> delete
- update -> 相反的update

逻辑日志：针对某一行记录的修改日志；
物理日志：记录的是整个页的修改；

2. 持久性，日志所做的修改，会持久化到磁盘
实现原理： redo log
WAL，write-ahead logging, 预写式日志，修改数据需要写两次日志；

3. 隔离性，
mysql 默认的是隔离级别是“可重复读“
四种隔离级别，你能模拟出来吗？
不同的隔离级别可能导致不同的并行问题：脏读、不可重复读、幻读
隔离性实现原理：锁

聊锁时，一定要明确存储引擎。
共享锁、排他锁、自增锁、间隙锁

表锁、行锁、数据库锁

InnoDB的行锁模式：
- 共享锁
- 排他锁
给索引加行锁，如果没有索引，则使用表锁。

4. 一致性，从一个一致性状态到另一个一致性状态
原子性、隔离性、持久性的目的就是为了保证一致性。

## 4. msql中日志分几类？

1. 二进制日志 binlog，服务器层
2. 慢查询日志 slowlog， 服务器层
3. redo/undo 日志， 存储引擎层，属于InnoDDB.

MVCC多版本并发控制？
事务A正在读操作，事务B正在更新，则事务A能够读到更新之前的数据。

## 5. 索引

### 5.1 mysql的索引实现机制是什么？为什么使用B+树？

B树 --> B+树

### 5.2 创建主键要不要自增？为什么？

要，

主键： 指定、唯一键、6字节的row_id生成一个主键

如果主键自增，那么聚簇索引中添加数据时，直接往磁盘后面追加即可。
如果不自增，那么B+树是有序的，如果随机插入，那么B+树就需要更新；

涉及到B+树的增删改查操作，需要搞清楚。

### 5.3 索引的分类

- 主键索引
- 辅助索引，叶子节点中放的不是实际的行记录，而是主键值。
  回表：先在辅助索引中查找主键，再到主键索引中查到行数据。
id为主键，name为辅助索引
select * from tb where name='jim'
select id from tb where name='jim'
这两者是有区别的，第一个需要回表，第二个不需要回表。第二条查询利用到了索引覆盖。

- 唯一索引
- 全文索引
- 组合索引
  最左匹配原则：
  如地址，省-市-镇-村
  [name, age]
  `select * from tb where name=? and age=?` 可以使用组合索引
  `select * from tb where name=?` 可以
  `select * from tb where age=?` 不可以
  `select * from tb where age=? and name=?` 可以，经过优化器之后，可以调整顺序
  组合索引的key是怎么存储的？


## 6. explain 执行计划

## 7. mysql 性能调优
1. 性能监控
2. schema与数据类型优化
3. 执行计划
4. 通过索引进行优化
   1. 优点
   2. 用处
   3. 分类
   4. 索引采用的数据结构
   5. 索引匹配方式
   6. 面试技术名词
      1. 聚簇索引
      2. 覆盖索引
      3. 最左匹配
5. 查询优化
6. 分区表
7. 服务器参数设置





## 8. 集群

主从复制：一主多从、主主复制
读写分离，读多写少， alibaba 变形虫项目
分库分表：垂直切分，水平切分



## 9. 思考

面试时，你永远不知道会问道什么，但能够尽自己的努力，做充分的准备。

项目驱动，并行化学习；

